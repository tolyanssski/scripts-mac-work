#!/bin/bash
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

PROMPT_FILE="${@}"

TASK_ID="codex-task-$(date +%Y%m%d-%H%M%S)-$$"
LOG_FILE=$PWD/.codex-task/logs/$TASK_ID.log
RESULT_FILE=$PWD/.codex-task/logs/$TASK_ID.RESULT.log

PROMPT_FILE=$DIR/prompts/codex/$PROMPT_FILE.md

if [ ! -f "$PROMPT_FILE" ]; then
    echo "File does not exist: $PROMPT_FILE"
    exit 1
fi

PROMPT="Текст задания прочитай в файле: $PROMPT_FILE, содержимое файла считай своим промптом"

codex exec \
 --full-auto \
 --skip-git-repo-check \
 --sandbox workspace-write \
 "$PROMPT"
